<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<js href="/thinkphp/Public/style/js/jquery-1.8.0.min.js" />
		<script type="text/javascript">
			function collect(data1){
				if(data1==0){
					$('span[name="del[]"]').each(function(){
					$(this).hide();
				})
				}
				var url='/thinkphp/index.php/home/index/collect';
				var wapname=$('#wapname').val();
				var waplink=$('#waplink').val();
				$.getJSON(url,{id:data1,wapname:wapname,waplink:waplink},function(data){
					if(data){
						if(data['link']){
							$('#owener').append("<a href="+data['link']+" style='text-decoration:none;width:80px;' target='_blank'><div id=data"+data['id']+" style='display:inline-block;width:125px;'><input type='hidden'  value="+data['id']+" /><span style='display:none;width:20px;color:red;' name='del[]' ><img  src='/thinkphp/public/style/pic/dele.png' style='width:17px;height:17px;'></span><img style='width:20px;height:20px;' src="+data['logo_url']+" /> <span style='font-size:12px;'>"+data['name']+"</span></div></a>");
							alert('收藏成功');
						}else{
							
							//$('#data'+data1).remove();
							$('#data'+data1).children('span[name="collect_name"]').html(wapname);
							$('#data'+data1).parents('a').attr('href',waplink);
							alert('编辑成功');
						}
					}else{
						alert('收藏失败');
					}
				});
			}
			function add(){
				$('#add').css('display','inline-block');
				$('input[name="edit"]').css('display','none');
				$('input[name="add"]').css('display','inline-block');
				$('#wapname').val('');
				$('#waplink').val('');
				$("#owener a").click(function(){
  						return false;
					})
				$('#add').css({
					'position': 'absolute',
					'top':'10%',
					//'filter':'alpha(opacity=50)',
					'background-color':'white',
					'z-index':'1002',
					'left':'20%',
					//'opacity':'0.5',
					//'-moz-opacity':'0.5',
					"height":'80%',
					'width':'60%',
				})

				$('.all').css({
					'position': 'fixed',
				    'width': '100%',
				    'height': '100%',
				    'left': '0',
				    'top': '0',
				    'z-index': '1001',
				    'filter': 'alpha(opacity=10)',
				    'opacity':'0.1',
					'-moz-opacity':'0.1',
				    'background': '#000',
				    "height":$(document).height(),
					'width':$(document).width(),
				})
			}
			function del(){
				
				$('#adddel').css('display','none');
				$('#dowork').css('display','inline-block');
				$('span[name="del[]"]').each(function(i){
					$(this).show();
					//$(this).parents('a').attr('href','#');
					$("#owener a").click(function(){
  						return false;
					})
					//$(this).parents('a').removeAttr('target');
					var collect_id=$(this).prev().val();
					
					$('#data'+collect_id).append("<img id='pen' src='/thinkphp/public/style/pic/pencil.png' style='width:16px;height:12px;' onclick='edit("+collect_id+");'>");
					
					$(this).click(function(){
						//var collect_id=$(this).prev().val();
						//$('#data'+collect_id).append("<img id='pen' src='/thinkphp/public/style/pic/pencil.png' style='width:16px;height:12px;'>");
						var url='/thinkphp/index.php/home/index/del';
						$.getJSON(url,{id:collect_id},function(data){
							if(data){
								$('#data'+collect_id).remove();
							}
						});
					})
				})
			}
			function work(){
				$("#owener a").unbind("click");
				$('#dowork').css('display','none');
				$('#adddel').css('display','inline-block');
				$('span[name="del[]"]').each(function(){
					$(this).hide();
					$(this).siblings('#pen').hide();
				})
				//$('#pen').hide();
			}
			function edit(id){
				$('#add').css('display','inline-block');
				$('input[name="add"]').css('display','none');
				$('input[name="edit"]').css('display','inline-block');
				
				$('#add').css({
					'position': 'absolute',
					'top':'10%',
					//'filter':'alpha(opacity=50)',
					'background-color':'white',
					'z-index':'1002',
					'left':'20%',
					//'opacity':'0.5',
					//'-moz-opacity':'0.5',
					"height":'80%',
					'width':'60%',
				})

				$('.all').css({
					'position': 'fixed',
				    'width': '100%',
				    'height': '100%',
				    'left': '0',
				    'top': '0',
				    'z-index': '1001',
				    'filter': 'alpha(opacity=10)',
				    'opacity':'0.1',
					'-moz-opacity':'0.1',
				    'background': '#000',
				    "height":$(document).height(),
					'width':$(document).width(),
				})
				
				var url='/thinkphp/index.php/home/index/edit';
				$.getJSON(url,{id:id},function(data){
					if(data){
						$('#wapname').val(data['name']);
						$('#waplink').val(data['link']);
						//onclick="collect(2)"
						$('input[name="edit"]').attr('onclick',"collect("+data['id']+")");
					}
				});
			}
			
			function close1(){
				$('#add').css('display','none');
				$('.all').removeAttr('style');
				$("#owener a").unbind("click");
			}
		</script>
		<style>
			#owener img{
				width:16px;
				height:16px;
			}
			#owener span{
				height:61px;
				line-height:61px;
				font-size:14px;
			}
		</style>
	</head>
	<body>
		<div  class="all">
			<div id="head" style="float:right;margin-right:100px;">
				<volist name="navigation" id="nav">
					{$nav}
				</volist>
			</div>
			<div id="start">
				<input type="hidden" id="start_bg" value="{$start_bg}"/>
					<img style='width:100px;height:100px;' id="imgstart" src='/thinkphp/Public/upload/start_bg/{$start_bg[$rand]['image_path']}'/><br/>
			</div>
			<div id="private" style="width:730px;">
				<div id="owener">
					<volist name="data" id="data1" key="i">
						<a href="{$data[$i-1]['link']}" style="text-decoration:none;width:80px;" target='_blank'>
							<div id="data{$data[$i-1]['id']}" style='display:inline-block;width:125px;'>
								<input type="hidden"  value="{$data[$i-1]['id']}" />
								<span style="display:none;width:20px;color:red;" name="del[]" ><img  src='/thinkphp/public/style/pic/dele.png' style='width:17px;height:17px;'></span>
								<img  src='{$data[$i-1]['logo_url']}' />
								<span name="collect_name">{$data[$i-1]['name'] |substr=0,6}</span>
							</div>
						</a>
					</volist>
				</div>
				</div>
				<a onclick="add()">添加收藏</a>-----<span id="adddel"><a onclick="del()">编辑</a></span><span id="dowork" style="display:none;"><a onclick="work()">完成</a></span>
		</div>
		
		<div style="display:none;float:center;background:#E6EAE7;width:100%;height:100%;" id="add">
			<input type="text" id="wapname" style="margin-top:30px;margin-left:15px;height:29px;" placeholder="名称"/>
			<input type="text"  id="waplink" style="width:50%;margin-left:15px;height:29px;" placeholder="网址"/>
			<input type="file"  name="" style="display:none;"/>
			<input type="button"  value="编辑收藏"  name="edit" style="margin-left:10px;height:35px;width:90px;text-align:center;background-color:#38f;border:none;color:white;"/>
			<input type="button"  value="添加收藏" onclick="collect(0)" name="add" style="margin-left:10px;background-color:#38f;border:none;color:white;height:35px;width:90px;text-align:center;"/>
			<input type="button"  value="关闭" onclick="close1();" style="height:35px;border:none;background-color:#FF8300;width:50px;"/>
		</div>
			
	</body>
</html>
